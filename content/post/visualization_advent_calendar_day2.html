---
title: "extrafont ggplot2で日本語ラベル (ver. 2.2.0 向け)"
author: "Shinya Uryu"
date: 2016-12-04T09:00:00
categories: ["R", "ggplot2", "visualization"]
featured: "161204-extrafont-1.png"
featuredpath: "date"
description:
    ggplot2でタイトルや軸名に日本語を扱いたい場合にextrafontを使うのがモダンっぽいという話。
---


<!-- BLOGDOWN-BODY-BEFORE

/BLOGDOWN-BODY-BEFORE -->

<p>一人visualizationの2日目（2つめの記事です。アドベントカレンダーとはなんだったのか…）。</p>
<p><strong><code>{ggplot2}</code></strong>でタイトルや軸名に日本語を扱いたい場合、いくつか方法があると思うのですが、私は普段次のコードを実行していました。</p>
<pre class="r"><code>library(magrittr)
library(ggplot2)</code></pre>
<pre class="r"><code>quartzFonts(YuGo = quartzFont(rep(&quot;YuGo-Medium&quot;, 4)))
theme_set(theme_classic(base_size = 12, base_family = &quot;YuGo&quot;))

iris %&gt;% ggplot(aes(Sepal.Length, Petal.Width)) +
  geom_point() +
  xlab(&quot;萼片長&quot;)</code></pre>
<p>基本的にはこれで日本語を組み込んだggplot2の図が描けるのですが、最近これだと<strong><code>{bookdown}</code></strong>によるPDF生成時にうまく表示されないという問題に直面しました。どうしたものかと悩んだ時に出てきたのが<strong><code>{extrafont}</code></strong>で、これを使うと無事に問題が解決したのでメモを残しておきます。ちなみにタイトルにあるように<strong><code>{ggplot2}</code></strong>のバージョンは現行の2.2.0です。</p>
<div id="extrafont" class="section level2">
<h2>extrafontを使用する準備</h2>
<p>まずパッケージがないと始まらないのでインストールします。<strong><code>{extrafont}</code></strong>をインストールすると、フォント管理用に<strong><code>{extrafontdb}</code></strong>というパッケージもインストールされます。</p>
<pre class="r"><code>install.packages(&quot;extrafont&quot;)</code></pre>
<p>パッケージを読み込みます。<strong><code>{extrafont}</code></strong>を初めて使う際やフォントを追加した場合には<code>font_import()</code>を実行してフォントを登録します。</p>
<pre class="r"><code>library(extrafont)</code></pre>
<pre><code>## Registering fonts with R</code></pre>
<pre class="r"><code># font_import()</code></pre>
<p><strong><code>{extrafont}</code></strong>はRで標準的に利用可能なPostScriptのフォントに対してTrueTypeフォントを利用可能にするパッケージで、これを使うことで多様なフォントをグラフに埋め込むことができます。</p>
<p><code>fonts()</code>を実行して登録済み（利用可能な）フォント名を確認してみましょう。</p>
<pre class="r"><code>myfonts &lt;- fonts()
myfonts %&gt;% length()</code></pre>
<pre><code>## [1] 104</code></pre>
<pre class="r"><code>myfonts %&gt;% sample(5)</code></pre>
<pre><code>## [1] &quot;Tw Cen MT&quot;   &quot;MS PGothic&quot;  &quot;Consolas&quot;    &quot;Batang&quot;      &quot;DejaVu Sans&quot;</code></pre>
<p>グラフの各要素に対し、フォントを設定するには次のような使い分けを行います</p>
<ul>
<li><em>family</em>引数に使いたいフォント名を与える。
<ul>
<li><strong><code>{ggplot2}</code></strong>の<code>geom_*()</code>で<em>family</em>引数があればこっちで指定</li>
</ul></li>
<li>タイトルや軸のラベルには<code>theme(... = element_text(base_family = ))</code>で指定しておく</li>
</ul>
<pre class="r"><code>library(ggplot2)
loadfonts(quiet = TRUE)

library(ggrepel)
mtcars$label &lt;- rownames(mtcars)
mtcars$label[1:15] &lt;- &quot;&quot;

p &lt;- ggplot(mtcars,
  aes(wt, mpg, label = label, colour = factor(cyl))) +
  geom_point()

p +  
  geom_text(aes(wt, mpg, colour = factor(cyl)),
              label = &quot;\uf1b9&quot;,
              family = &quot;FontAwesome&quot;,
              size = 4) +
  geom_text_repel(data = mtcars, aes(wt, mpg, label = label, family = &quot;xkcd&quot;)) +
  xlab(&quot;重量&quot;) +
  ylab(&quot;マイル / ガロン&quot;) +
  theme(text = element_text(size = 16, family = &quot;IPAexMincho&quot;))</code></pre>
<p>これで冒頭の矛盾系AAのような図を作れます。<strong><code>{bookdown}</code></strong>に埋め込む図もこれでOK</p>
<p><strong>Windows?知らん <code>skip_on_os(&quot;windows)&quot;</code></strong>（環境がないので試せていない）。</p>
</div>
<div class="section level2">
<h2>参考</h2>
<ul>
<li><a href="http://qiita.com/miiton@github/items/1e50ab643653b7a58954">Rでpdfに好きな日本語フォントを使用する - Qiita</a></li>
<li><a href="http://notchained.hatenablog.com/entry/2015/06/02/235436">ggplot2でFont Awesomeのアイコンを使ってプロット</a></li>
<li><a href="http://kenpg2.seesaa.net/article/414814562.html">R + extrafont パッケージで数式を PDF に埋め込む : 研究に使うポスグレ</a></li>
</ul>
</div>



<!-- BLOGDOWN-HEAD






/BLOGDOWN-HEAD -->
